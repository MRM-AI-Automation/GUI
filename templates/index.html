<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMU Data and Visualization</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/main.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='scripts/app.js') }}"></script>
</head>

<body>
    <h1>IMU Data and Visualization</h1>
    <div id="imu-data">
        <div class="imu-section" id="linear-acceleration" onclick="createGraph('linear-acceleration')">
            <h3>Linear Acceleration</h3>
            <p><strong>X:</strong> <span id="linear-acceleration-x"></span></p>
            <p><strong>Y:</strong> <span id="linear-acceleration-y"></span></p>
            <p><strong>Z:</strong> <span id="linear-acceleration-z"></span></p>
        </div>

        <div class="imu-section" id="angular-velocity" onclick="createGraph('angular-velocity')">
            <h3>Angular Velocity</h3>
            <p><strong>X:</strong> <span id="angular-velocity-x"></span></p>
            <p><strong>Y:</strong> <span id="angular-velocity-y"></span></p>
            <p><strong>Z:</strong> <span id="angular-velocity-z"></span></p>
        </div>

        <div class="imu-section" id="orientation" onclick="createGraph('orientation')">
            <h3>Orientation</h3>
            <p><strong>X:</strong> <span id="orientation-x"></span></p>
            <p><strong>Y:</strong> <span id="orientation-y"></span></p>
            <p><strong>Z:</strong> <span id="orientation-z"></span></p>
        </div>
    </div>

    <div class="graph-container" id="graph-container"></div>
    <div id="canvas-container"></div>

    <!-- ... (your existing HTML) ... -->

<script>
    function createGraph(type) {
        // Create a new canvas element for the graph
        const canvas = document.createElement('canvas');
        canvas.width = 150; // Set the width as needed
        canvas.height = 75; // Set the height as needed
        canvas.style.marginTop = '10px';

        // Append the canvas to the graph container
        document.getElementById('graph-container').innerHTML = '';
        document.getElementById('graph-container').appendChild(canvas);

        // Initialize the data structure for the last 30 seconds
        const initData = Array.from({ length: 30 }, () => ({ x: null, y: null, z: null }));

        // Create a chart using Chart.js
        const ctx = canvas.getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({ length: 30 }, (_, i) => i + 1), // Labels for the last 30 seconds
                datasets: [
                    {
                        label: `${type} X`,
                        data: initData.map(entry => entry.x),
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                    },
                    {
                        label: `${type} Y`,
                        data: initData.map(entry => entry.y),
                        backgroundColor: 'rgba(155, 89, 182, 0.2)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(155, 89, 182, 1)',
                    },
                    {
                        label: `${type} Z`,
                        data: initData.map(entry => entry.z),
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(46, 204, 113, 1)',
                    },
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Function to update the chart with new data
        function updateChart() {
            // Get the values for the selected type
            const xValue = parseFloat(document.getElementById(`${type}-x`).innerText);
            const yValue = parseFloat(document.getElementById(`${type}-y`).innerText);
            const zValue = parseFloat(document.getElementById(`${type}-z`).innerText);

            // Update the data structure with the new values
            const newData = { x: xValue, y: yValue, z: zValue };
            chart.data.datasets[0].data.shift();
            chart.data.datasets[1].data.shift();
            chart.data.datasets[2].data.shift();
            chart.data.datasets[0].data.push(newData.x);
            chart.data.datasets[1].data.push(newData.y);
            chart.data.datasets[2].data.push(newData.z);

            // Update the chart
            chart.update();
        }

        // Set up an interval to update the chart every second
        setInterval(updateChart, 1000);
    }
</script>

</body>

</html>
